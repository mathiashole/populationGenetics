---
title: "EJERCICIOS P1"
date: today
date-format: "DD MMMM, YYYY"
author: 
  Mathias
abstract:
    Genetica de poblaciones
abstractspacing: double
appendix: false
fontfamily: libertine
monofont: inconsolata
monofontoptions: scaled=.95
fontsize: 12pt
geometry: 
  - top=2cm
  - bottom=2cm
  - left=2cm
  - right=2cm
urlcolor: darkblue
highlight-style: arrow
format: 
    pdf:
      toc: true
      number-sections: true
      colorlinks: true
---

# Ejercicio 5: Estudio farmaceutico

1. La frecuencia de un alelo autosómico A en una población es $p = 0.1$.
¿Cuál es el número esperado de alelos A en una muestra de 20 alelos?
¿Cuál es la probabilidad de no observar el alelo A en la muestra?
2. Utilizando la función rbinom, simule un gran número de muestras de tamaño $n = 20$ y
caracterice la distribución de los resultados utilizando descriptores gráficos y numéricos
apropiados.
3. Considere ahora el caso de $f(A) = p = 0.01$.¿Cuál es la probabilidad de observar el alelo
A en una muestra de $n = 20$?
4. La frecuencia observada de un alelo autosómico diploide A es 3/10 (tamaño de la
muestra $n = 10$). Utilice dbinom para calcular la probabilidad de observar esta frecuencia
en la muestra para un rango de frecuencias subyacentes en la población entre 0,01 y
0,99.
5. Genotipos como muestras aleatorias de tamaño $n = 2$. Para un locus autosómico
diploide con dos alelos, describa las proporciones de HW como esperanzas de la
distribución binomial.
6. Para una muestra de $n = 10$ individuos, obtenga la frecuencia esperada de
heterocigotos para $f(A) = 0.3$ y utilice rbinom para simular un gran número de muestras
y caracterizar la variación aleatoria de la frecuencia observada de heterocigotos.
7. nota: el 3 muestra (no demuestra) que $MLE(p) = \hat{p}$
8. Para n=4, obtener en R una simulación de todos los componentes del proceso
coalescente. Asumir que $N = 5\times 10^{5}$ y $\mu = 10-5$. Para la realización obtenida, calcular $\pi$, $S$
y 𝜃w.
9. Structure:
El programa structure se corrió con $K = 2$ y 90 genotipos, y la cadena de MCMC paró en la
generación $m-1$. Nos enfocamos en un sólo locus con alelos.
El estado de la cadena en $m-1$ es el siguiente:
Frecuencias del alelo de referencia en cada subpoblación:
$P(m-1)1 = 0.5$, $P(m-1)2 = 0.8$.
Ubicación de los genotipos a subpoblaciones:

|      | Subpoblación 1 | Subpoblación 2 |
|------|----------------|----------------|
| $𝐴𝐴$ |      13        |      25        |
| $𝐴𝑎$ |      24        |       13       |
| $𝑎𝑎$  |      13        |      2         |
| Total |     50        |       40       |

a) Usando una distribución apropiada, obtener valores propuestos de para la $P$
generación $m[P(m)]$ para cada subpoblación. Explicar, en cada caso, si deberían ser 
aceptadas como los nuevos valores $P(m)_{1}$ y $P(m)_{2}$ y con qué regla de
probabilidad.
b) Ahora considerar un genotipo que puede moverse de la subpoblación 1 a la 2.𝐴𝑎
Explicar cómo se toma la decisión de moverlo o no.
En las respuestas, incluir tanto las explicaciones como el código de R o los cálculos
equivalentes.

# Ejercicio 1: Frecuencia de alelo p=0.1

Para responder a estas preguntas, tratamos la extracción de cada alelo como un ensayo de Bernoulli, donde "éxito" es obtener el alelo A.

    ¿Cuál es el número esperado de alelos A en una muestra de 20 alelos?
    La esperanza de una distribución binomial se calcula como E(X)=n⋅p. En este caso, el tamaño de la muestra (n) es 20 y la frecuencia alélica (p) es 0.1.
    E(X)=20⋅0.1=2.
    Se espera que, en promedio, haya 2 alelos A en una muestra de 20.

    ¿Cuál es la probabilidad de no observar el alelo A en la muestra?
    Aquí buscamos la probabilidad de obtener 0 éxitos (k=0) en 20 ensayos. Usamos la fórmula de la función de masa de probabilidad binomial: P(X=k)=C(n,k)⋅pk⋅(1−p)n−k.
    P(X=0)=C(20,0)⋅(0.1)0⋅(1−0.1)20=1⋅1⋅(0.9)20≈0.1216.
    Hay un 12.16% de probabilidad de no encontrar ningún alelo A en la muestra.

# Ejercicio 2: Simulación con rbinom

El objetivo de este ejercicio es simular el proceso de muestreo miles de veces para ver cómo los resultados se distribuyen alrededor del valor esperado. rbinom en R genera números aleatorios basados en una distribución binomial.
R
```{r}

# Definir los parámetros
n <- 20  # Tamaño de la muestra
p <- 0.1  # Frecuencia del alelo A

# Simular 10,000 muestras
num_simulaciones <- 10000
muestras_simuladas <- rbinom(n = num_simulaciones, size = n, prob = p)

# Descriptores numéricos
media_simulada <- mean(muestras_simuladas)
print(paste("La media de las simulaciones es:", round(media_simulada, 2)))
print(paste("La desviación estándar de las simulaciones es:", round(sd(muestras_simuladas), 2)))

# Gráfico de la distribución
hist(muestras_simuladas,
     breaks = seq(-0.5, n + 0.5, by = 1),
     col = "skyblue",
     border = "white",
     main = "Distribución de alelos A en 10,000 muestras",
     xlab = "Número de alelos A",
     ylab = "Frecuencia")
```

# Ejercicio 3: Frecuencia de alelo p=0.01

Para encontrar la probabilidad de observar el alelo A, es más fácil calcular la probabilidad de no observarlo (0 alelos) y restarla de 1.

P(observar A)=1−P(no observar A)
P(X≥1)=1−P(X=0)=1−C(20,0)⋅(0.01)0⋅(0.99)20=1−(0.99)20≈1−0.8179=0.1821.
La probabilidad de observar al menos un alelo A es de aproximadamente 18.21%.

Ejercicio 4: Frecuencia observada de 3/10

Aquí invertimos el problema: tenemos la muestra y queremos saber qué tan probable es esta observación para diferentes frecuencias poblacionales. Usamos dbinom, que calcula la probabilidad de un número específico de éxitos.
R

```{r}
# Definir los parámetros de la muestra
k_observado <- 3
n_muestra <- 10

# Rango de frecuencias poblacionales para evaluar
frecuencias_poblacionales <- seq(0.01, 0.99, by = 0.01)

# Calcular la probabilidad para cada frecuencia poblacional
probabilidades <- dbinom(x = k_observado, size = n_muestra, prob = frecuencias_poblacionales)

# Gráfico de la verosimilitud
plot(frecuencias_poblacionales,
     probabilidades,
     type = "l",
     lwd = 2,
     col = "darkgreen",
     main = "Probabilidad de observar 3/10 alelos A",
     xlab = "Frecuencia poblacional hipotética (p)",
     ylab = "Probabilidad de la muestra observada")

# Marcar el punto de máxima probabilidad
max_p <- frecuencias_poblacionales[which.max(probabilidades)]
points(max_p, max(probabilidades), col = "red", pch = 19)
text(max_p, max(probabilidades), labels = paste("p =", round(max_p, 2)), pos = 4, col = "red")
```

# Ejercicio 5: Proporciones de Hardy-Weinberg (HW)

Las proporciones de Hardy-Weinberg describen la distribución de genotipos en una población en equilibrio. Podemos ver la formación de un genotipo como el resultado de tomar una muestra de 2 alelos, uno de cada padre.

    Genotipo homocigoto dominante (AA): Para obtener este genotipo, ambos alelos deben ser A. La probabilidad de que esto ocurra es la de obtener 2 éxitos (k=2) en 2 ensayos, lo que es igual a p2.
    P(X=2)=C(2,2)⋅p2⋅(1−p)0=p2.

    Genotipo heterocigoto (Aa): Para obtener este genotipo, necesitamos 1 alelo A y 1 alelo a. La probabilidad de obtener 1 éxito (k=1) en 2 ensayos es 2p(1−p).
    P(X=1)=C(2,1)⋅p1⋅(1−p)1=2p(1−p).

Las proporciones de HW (p2, 2pq, q2) son, de hecho, las esperanzas de una distribución binomial con n=2 ensayos, modelando la selección aleatoria de alelos para formar un genotipo.

# Ejercicio 6: Frecuencia esperada de heterocigotos

Primero calculamos la frecuencia esperada de heterocigotos en la población usando las proporciones de HW, y luego usamos rbinom para simular su variación en muestras.

    Frecuencia esperada de heterocigotos:
    Si la frecuencia de un alelo es p=0.3, la frecuencia de heterocigotos en la población es 2p(1−p)=2⋅0.3⋅(1−0.3)=0.42. En una muestra de 10 individuos, el número esperado de heterocigotos es 10⋅0.42=4.2.

    Simulación de la variación:
    El tamaño de la muestra es de 10 individuos, y la probabilidad de que un individuo sea heterocigoto es 0.42. Usamos rbinom para simular esto.

```{r}
# Definir los parámetros
p_alelo_A <- 0.3
prob_heterocigoto <- 2 * p_alelo_A * (1 - p_alelo_A)
n_individuos <- 10

# Simular la variación de la frecuencia de heterocigotos
num_simulaciones <- 10000
muestras_heterocigotos <- rbinom(n = num_simulaciones, size = n_individuos, prob = prob_heterocigoto)

# Caracterizar la distribución
media_simulada_h <- mean(muestras_heterocigotos)
print(paste("La media de heterocigotos simulados es:", round(media_simulada_h, 2)))
print(paste("La desviación estándar de las simulaciones es:", round(sd(muestras_heterocigotos), 2)))

# Gráfico de la distribución
hist(muestras_heterocigotos,
     breaks = seq(-0.5, n_individuos + 0.5, by = 1),
     col = "lightcoral",
     border = "white",
     main = "Distribución de heterocigotos en 10,000 muestras",
     xlab = "Número de heterocigotos",
     ylab = "Frecuencia")
```


```{r}
# Datos observados
observados <- matrix(c(50, 30, 20, 40, 45, 15), nrow = 2, byrow = TRUE)

# Realizar el test chi-cuadrado
test_chi2 <- chisq.test(observados)

# Resultado del test
test_chi2

```

No hay suficiente evidencia para rechazar la $H_0$.


## Cálculo del estadístico $\chi^2$ sin usar funcion de R:

La prueba $\chi^2$ que da el valor de X-squared, se calcula usando la ecuacion

$$
\chi^2 = \sum_{i=1}^{r} \sum_{j=1}^{c} \frac{(O_{ij} - E_{ij})^2}{E_{ij}}
$$

Donde $O_{ij}$ son las frecuencias observadas y $E_{ij}$ son las frecuencias esperadas.

$$
\chi^2 = \frac{(50 - 45)^2}{45} + \frac{(30 - 37.5)^2}{37.5} + \frac{(20 - 17.5)^2}{17.5} + \frac{(40 - 45)^2}{45} + \frac{(45 - 37.5)^2}{37.5} + \frac{(15 - 17.5)^2}{17.5}
$$

Siendo

$$
\chi^2 = \frac{25}{45} + \frac{56.25}{37.5} + \frac{6.25}{17.5} + \frac{25}{45} + \frac{56.25}{37.5} + \frac{6.25}{17.5} = 0.556 + 1.5 + 0.357 + 0.556 + 1.5 + 0.357 = 4.826
$$

Los grados de libertad se calculan segun los numeros de r = row (fila) y c = column (columna):

$$
\text{gl} = (r - 1)(c - 1) = (2 - 1)(3 - 1) = 2
$$

El valor de la tabla ($\chi^2$) para un nivel de significancia ($\alpha = 0.05$) y 2 grados de libertad es aproximadamente 5.99. Ver tabla $\chi^2$

Como el estadístico calculado ($\chi^2 = 4.826$) es menor que 5.99, no rechazamos la hipótesis nula.
